<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Astrology App</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #111;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    nav {
      display: flex;
      margin-top: 10px;
    }

    nav button {
      background: #222;
      border: 1px solid white;
      color: white;
      padding: 10px;
      cursor: pointer;
    }

    nav button.active {
      background: #555;
    }

    section {
      display: none;
      width: 90%;
      max-width: 600px;
      margin-top: 20px;
    }

    section.active {
      display: block;
    }

    canvas {
      border: 2px solid white;
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    td, th {
      border: 1px solid white;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>Astrology App</h1>

  <!-- Navigation Tabs -->
  <nav>
    <button class="tab active" data-tab="chart">Chart</button>
    <button class="tab" data-tab="solar">Solar Data</button>
    <button class="tab" data-tab="planets">Planets</button>
  </nav>

  <!-- Astrology Chart -->
  <section id="chart" class="active">
    <canvas id="chartCanvas" width="400" height="400"></canvas>
    <div id="chartInfo"></div>
  </section>

  <!-- Solar Information -->
  <section id="solar">
    <h2>Solar Data</h2>
    <div id="solarInfo">Loading...</div>
  </section>

  <!-- Planetary Table -->
  <section id="planets">
    <h2>Planetary Positions</h2>
    <table>
      <thead>
        <tr><th>Planet</th><th>Longitude (°)</th></tr>
      </thead>
      <tbody id="planetTable"></tbody>
    </table>
  </section>

  <!-- Main Logic -->
<script type="module">
  import julian from './astronomia/src/julian.js';
  import base from './astronomia/src/base.js';
  import solar from './astronomia/src/solar.js';
  import nutation from './astronomia/src/nutation.js';
  import { Planet } from './astronomia/src/planetposition.js';

  // Planet data
  import mercuryData from './astronomia/data/vsop87Bmercury.js';
  import venusData from './astronomia/data/vsop87Bvenus.js';
  import earthData from './astronomia/data/vsop87Bearth.js';
  import marsData from './astronomia/data/vsop87Bmars.js';
  import jupiterData from './astronomia/data/vsop87Bjupiter.js';
  import saturnData from './astronomia/data/vsop87Bsaturn.js';
  import uranusData from './astronomia/data/vsop87Buranus.js';
  import neptuneData from './astronomia/data/vsop87Bneptune.js';
  // Pluto omitted for now

  // Canvas setup
  const canvas = document.getElementById('chartCanvas');
  const ctx = canvas.getContext('2d');
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const solarInfo = document.getElementById('solarInfo');
  const planetTable = document.getElementById('planetTable');
  const chartInfo = document.getElementById('chartInfo');

  // Planet setup
  const planets = [
    { name: 'Mercury', data: new Planet(mercuryData), color: '#aaa', radius: 40 },
    { name: 'Venus',   data: new Planet(venusData),   color: '#cfa', radius: 60 },
    { name: 'Earth',   data: new Planet(earthData),   color: '#6cf', radius: 80 },
    { name: 'Mars',    data: new Planet(marsData),    color: '#f66', radius: 100 },
    { name: 'Jupiter', data: new Planet(jupiterData), color: '#ffc', radius: 120 },
    { name: 'Saturn',  data: new Planet(saturnData),  color: '#ddf', radius: 140 },
    { name: 'Uranus',  data: new Planet(uranusData),  color: '#9ff', radius: 160 },
    { name: 'Neptune', data: new Planet(neptuneData), color: '#99f', radius: 180 }
  ];

  // Julian Day
  function getCurrentJD() {
    return julian.DateToJD(new Date());
  }

  // Draw the full heliocentric chart
  function drawHeliocentricChart(jd) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw Sun at center
    ctx.fillStyle = 'yellow';
    ctx.beginPath();
    ctx.arc(cx, cy, 10, 0, 2 * Math.PI);
    ctx.fill();

    // Draw each planet's orbit and position
    for (const planet of planets) {
      const lon = planet.data.position(jd).lon;
      const angle = lon; // radians

      // Orbit
      ctx.strokeStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx, cy, planet.radius, 0, 2 * Math.PI);
      ctx.stroke();

      // Planet position
      const x = cx + planet.radius * Math.cos(angle);
      const y = cy + planet.radius * Math.sin(angle);
      ctx.fillStyle = planet.color;
      ctx.beginPath();
      ctx.arc(x, y, 6, 0, 2 * Math.PI);
      ctx.fill();

      // Label
      ctx.fillStyle = 'white';
      ctx.font = '12px sans-serif';
      ctx.fillText(planet.name, x + 8, y);
    }
  }

  // Solar data UI
  function updateSolarInfo(jd) {
    const T = base.J2000Century(jd);
    const lon = solar.apparentLongitude(T);
    const ε = nutation.meanObliquity(jd);

    solarInfo.innerHTML = `
      <p><b>Solar Longitude:</b> ${(lon * 180 / Math.PI).toFixed(2)}°</p>
      <p><b>Mean Obliquity (ε):</b> ${(ε * 180 / Math.PI).toFixed(2)}°</p>
      <p><b>Sunrise:</b> 6:00 AM (placeholder)</p>
      <p><b>Sunset:</b> 8:00 PM (placeholder)</p>
      <p><b>Solar Noon:</b> 1:00 PM (placeholder)</p>
      <p><b>Next Equinox:</b> Sep 22, 2025 (placeholder)</p>
    `;
  }

  // Planet table UI
  function updatePlanetTable(jd) {
    planetTable.innerHTML = '';
    for (const planet of planets) {
      const lon = planet.data.position(jd).lon;
      const degrees = (lon * 180 / Math.PI) % 360;
      const row = document.createElement('tr');
      row.innerHTML = `<td>${planet.name}</td><td>${degrees.toFixed(2)}</td>`;
      planetTable.appendChild(row);
    }
  }

  // Animate chart
  function animate() {
    const jd = getCurrentJD();
    drawHeliocentricChart(jd);
    updateSolarInfo(jd);
    updatePlanetTable(jd);
    chartInfo.textContent = 'Sun-centered planetary orbits';
    requestAnimationFrame(animate);
  }

  animate();

  // Tab switching logic
  document.querySelectorAll('.tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });
</script>

  

</body>
</html>

